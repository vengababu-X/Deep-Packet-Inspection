#!/bin/bash
#
# QUICK START GUIDE - C++ Packet Analyzer
#
# This guide shows different ways to use the packet analyzer
#

echo "==========================================="
echo "  C++ Packet Analyzer - Usage Examples"
echo "==========================================="
echo ""

# Example 1: Basic usage
echo "═══════════════════════════════════════════"
echo "EXAMPLE 1: Basic Usage"
echo "═══════════════════════════════════════════"
echo ""
echo "Description: Run packet analyzer for all network packets"
echo ""
echo "Command:"
echo "  $ sudo ./packet_analyzer"
echo ""
echo "Output:"
echo "  [*] Finding network devices..."
echo "  [*] Using network interface: eth0"
echo "  [*] Starting packet capture (Ctrl+C to stop)..."
echo ""
echo "  [Packet #1] Len=66B TCP"
echo "    Ethernet: 7c:10:c9:xx:xx:xx -> ff:ff:ff:ff:ff:ff"
echo "    IPv4: 192.168.1.100 -> 8.8.8.8 [54821 -> 443]"
echo ""

# Example 2: Using with tcpdump filters
echo "═══════════════════════════════════════════"
echo "EXAMPLE 2: Monitor traffic to specific IP"
echo "═══════════════════════════════════════════"
echo ""
echo "Terminal 1 - Start packet analyzer:"
echo "  $ sudo ./packet_analyzer"
echo ""
echo "Terminal 2 - Generate traffic to 8.8.8.8:"
echo "  $ ping -c 10 8.8.8.8"
echo "  $ curl -I https://google.com"
echo ""

# Example 3: Flow tracking
echo "═══════════════════════════════════════════"
echo "EXAMPLE 3: View captured flows"
echo "═══════════════════════════════════════════"
echo ""
echo "After stopping capture (Ctrl+C), the program displays:"
echo ""
echo "  === CAPTURED FLOWS ==="
echo "  Source                   Destination              Packets   Bytes      Application"
echo "  192.168.1.100:54821    -> 8.8.8.8:443               15        8245       Google"
echo "  10.0.0.5:45632         -> 172.217.160.46:80        8         2156"
echo ""

# Example 4: Statistics
echo "═══════════════════════════════════════════"
echo "EXAMPLE 4: View statistics"
echo "═══════════════════════════════════════════"
echo ""
echo "After stopping capture (Ctrl+C), the program displays:"
echo ""
echo "  === CAPTURE STATISTICS ==="
echo "  Total Packets: 1234"
echo "  Total Bytes: 567890"
echo "  IPv4 Packets: 1200"
echo "  Other Packets: 34"
echo "  IPv4 Percentage: 97.25%"
echo ""

# Example 5: Protocol detection
echo "═══════════════════════════════════════════"
echo "EXAMPLE 5: Protocol Detection"
echo "═══════════════════════════════════════════"
echo ""
echo "The analyzer automatically detects:"
echo ""
echo "  TCP Packets:"
echo "    [Packet #1] Len=66B TCP"
echo "    IPv4: 192.168.1.100 -> 8.8.8.8 [443 -> 54821]"
echo ""
echo "  UDP Packets:"
echo "    [Packet #2] Len=54B UDP"
echo "    IPv4: 192.168.1.100 -> 1.1.1.1 [53892 -> 53]"
echo ""
echo "  ICMP Packets (ping):"
echo "    [Packet #3] Len=64B ICMP"
echo "    IPv4: 192.168.1.100 -> 8.8.8.8"
echo ""

# Example 6: Building from source
echo "═══════════════════════════════════════════"
echo "EXAMPLE 6: Build from Source"
echo "═══════════════════════════════════════════"
echo ""
echo "Prerequisites (Ubuntu/Debian):"
echo "  $ sudo apt update"
echo "  $ sudo apt install build-essential libpcap-dev"
echo ""
echo "Build:"
echo "  $ cd /path/to/DPI"
echo "  $ make clean"
echo "  $ make"
echo ""
echo "Result:"
echo "  $ ls -lh packet_analyzer"
echo "  -rwxr-xr-x 1 user user 80K Feb 22 06:44 packet_analyzer"
echo ""

# Example 7: Using setup script
echo "═══════════════════════════════════════════"
echo "EXAMPLE 7: Automated Setup (Optional)"
echo "═══════════════════════════════════════════"
echo ""
echo "Installation with automatic dependency setup:"
echo "  $ sudo bash setup.sh"
echo ""
echo "This script will:"
echo "  1. Detect your OS (Ubuntu, CentOS, macOS, etc)"
echo "  2. Install build-essential and libpcap-dev"
echo "  3. Compile the project"
echo "  4. Display ready-to-run instructions"
echo ""

# Example 8: Docker (optional future enhancement)
echo "═══════════════════════════════════════════"
echo "EXAMPLE 8: Advanced - Using with iperf"
echo "═══════════════════════════════════════════"
echo ""
echo "Terminal 1 - Start packet analyzer:"
echo "  $ sudo ./packet_analyzer"
echo ""
echo "Terminal 2 - Run iperf server:"
echo "  $ iperf -s"
echo ""
echo "Terminal 3 - Run iperf client:"
echo "  $ iperf -c localhost -t 10"
echo ""
echo "Result: Analyzer shows continuous TCP traffic to port 5001"
echo ""

# Example 9: Filtering by MAC address visualization
echo "═══════════════════════════════════════════"
echo "EXAMPLE 9: MAC Address Tracking"
echo "═══════════════════════════════════════════"
echo ""
echo "The analyzer displays MAC addresses for network troubleshooting:"
echo ""
echo "  [Packet #1] Len=66B TCP"
echo "    Ethernet: aa:bb:cc:dd:ee:ff -> 11:22:33:44:55:66"
echo "    IPv4: 192.168.1.100 -> 8.8.8.8 [54821 -> 443]"
echo ""
echo "This helps identify:"
echo "  - Physical network devices (by MAC)"
echo "  - Gateway and switch ports"
echo "  - Network interface information"
echo ""

# Example 10: Troubleshooting
echo "═══════════════════════════════════════════"
echo "EXAMPLE 10: Troubleshooting"
echo "═══════════════════════════════════════════"
echo ""
echo "Issue: 'pcap_open_live: Permission denied'"
echo "Solution: Use sudo"
echo "  $ sudo ./packet_analyzer"
echo ""
echo "Issue: 'No network devices found'"
echo "Solution: Check active interfaces"
echo "  $ ip link show"
echo "  $ ifconfig"
echo ""
echo "Issue: No packets captured"
echo "Solution: Generate traffic"
echo "  Terminal 1: $ sudo ./packet_analyzer"
echo "  Terminal 2: $ ping google.com"
echo ""
echo "Issue: Command 'make' not found"
echo "Solution: Install build tools"
echo "  $ sudo apt install build-essential"
echo ""

# Example 11: Continuous monitoring (background)
echo "═══════════════════════════════════════════"
echo "EXAMPLE 11: Background Monitoring"
echo "═══════════════════════════════════════════"
echo ""
echo "Run analyzer in background and redirect output:"
echo "  $ sudo ./packet_analyzer > capture.log 2>&1 &"
echo "  $ tail -f capture.log"
echo ""
echo "Kill background process later:"
echo "  $ pkill -f packet_analyzer"
echo ""

# Example 12: Performance testing
echo "═══════════════════════════════════════════"
echo "EXAMPLE 12: Performance Testing"
echo "═══════════════════════════════════════════"
echo ""
echo "Test with high-speed traffic:"
echo "  Terminal 1: $ sudo time ./packet_analyzer"
echo ""
echo "Terminal 2 - Generate sustained load:"
echo "  $ while true; do ping -c 100 8.8.8.8; done"
echo ""
echo "Observe:"
echo "  - CPU usage (should be <1%)"
echo "  - Memory usage (should be <10MB)"
echo "  - Packet count and stats at exit"
echo ""

# Example 13: Multiple interfaces
echo "═══════════════════════════════════════════"
echo "EXAMPLE 13: List Network Interfaces"
echo "═══════════════════════════════════════════"
echo ""
echo "The analyzer automatically selects the first non-loopback"
echo "interface. To see available interfaces:"
echo ""
echo "  $ ip link show"
echo "  1: lo: <LOOPBACK>"
echo "  2: eth0: <BROADCAST,MULTICAST,UP>"
echo "  3: wlan0: <BROADCAST,MULTICAST,UP>"
echo ""
echo "The analyzer will use 'eth0' (first non-loopback)"
echo ""

# Example 14: Integration with other tools
echo "═══════════════════════════════════════════"
echo "EXAMPLE 14: Pipeline with Other Tools"
echo "═══════════════════════════════════════════"
echo ""
echo "Capture packets to file:"
echo "  $ sudo ./packet_analyzer 2>&1 | tee traffic.txt"
echo ""
echo "Count TCP packets:"
echo "  $ sudo ./packet_analyzer 2>&1 | grep 'TCP' | wc -l"
echo ""
echo "Find all domains accessed:"
echo "  $ sudo ./packet_analyzer 2>&1 | grep 'IPv4' | cut -d' ' -f3"
echo ""

# Summary
echo "═══════════════════════════════════════════"
echo "SUMMARY"
echo "═══════════════════════════════════════════"
echo ""
echo "Quick Reference:"
echo "  Build:            make"
echo "  Clean:            make clean"
echo "  Run:              sudo ./packet_analyzer"
echo "  Stop:             Ctrl+C"
echo ""
echo "Key Features:"
echo "  ✅ Real-time packet capture"
echo "  ✅ Ethernet & IPv4 header parsing"
echo "  ✅ TCP/UDP port extraction"
echo "  ✅ Flow-based statistics"
echo "  ✅ Protocol detection"
echo ""
echo "For more information, see README.md and ARCHITECTURE.md"
echo ""
